{% extends "layout.html" %}
{% load l10n %}

{% block body %}

<h3>Benefits Dashboard</h3>
<hr>

<div class="row mb-3 align-items-center">
  <div class="col-md-6">

    <form method="get" class="d-flex" style="gap: 10px;">

      <!-- Search -->
      <input type="text" name="q" class="form-control" placeholder="Sicil No or Name"
            value="{{ query|default_if_none:'' }}" style="max-width:200px;">

      <!-- Year dropdown -->
      <select name="year" class="form-select" style="max-width:120px;">
          <option value="">Year</option>
          {% for y in year_list %}
              {% localize off %}
              <option value="{{ y }}" {% if selected_year == y|stringformat:'s' %}selected{% endif %}>
                  {{ y }}
              </option>
              {% endlocalize %}
          {% endfor %}
      </select>

      <!-- Month dropdown -->
      <select name="month" class="form-select" style="max-width:120px;">
          <option value="">Month</option>
          {% for m in month_list %}
              <option value="{{ m.0 }}" {% if selected_month == m.0|stringformat:'s' %}selected{% endif %}>
                  {{ m.1 }}
              </option>
          {% endfor %}
      </select>

      <button type="submit" class="btn btn-primary">Search</button>
      <a href="{% url 'benefits:list' %}" class="btn btn-secondary">Clear</a>
    </form>

  </div>

  <div class="col-md-6 text-end">
    <a href="{% url 'benefits:bulk' %}"
      class="btn me-2"
      style="background:#6f42c1; border:1px solid #5a35a3; color:#f2efff; font-weight:600;"
      onmouseover="this.style.backgroundColor='#5b36a3'; this.style.borderColor='#4f2f92'; this.style.color='#ffffff';"
      onmouseout="this.style.backgroundColor='#6f42c1'; this.style.borderColor='#5a35a3'; this.style.color='#f2efff';">
      Bulk Add/Update
    </a>

    <a href="{% url 'benefits:import_benefits' %}"
      class="btn me-2"
      style="background:#6f42c1; border:1px solid #5a35a3; color:#f2efff; font-weight:600;"
      onmouseover="this.style.backgroundColor='#5b36a3'; this.style.borderColor='#4f2f92'; this.style.color='#ffffff';"
      onmouseout="this.style.backgroundColor='#6f42c1'; this.style.borderColor='#5a35a3'; this.style.color='#f2efff';">
      Import Excel
    </a>

    <a class="btn btn-success" href="{% url 'benefits:create' %}">+ New</a>
  </div>
</div>


<table class="table table-bordered table-hover">
  <thead class="table-light">
    <tr>
      <th>Sicil No</th>
      <th>Name Surname</th>
      <th>Cost Center</th>
      <th>Group</th>

      <th>Family</th>
      <th>Food</th>
      <th>Gold</th>
      <th>Bayram</th>
      <th>Birth & Marriage</th>
      <th>Funding</th>
      <th>Subsistence</th>
      <th>Fare</th>
      <th>Premium</th>

      <th>Year</th>
      <th>Month</th>

      <th style="width:140px;">Process</th>
    </tr>
  </thead>

  <tbody>
    {% for b in page_obj %}
    <tr>

      <td>{{ b.worker.sicil_no }}</td>
      <td>{{ b.name_surname }}</td>

      <td>
        {% if b.worker.s_no and b.worker.s_no.code %}
          {{ b.worker.s_no.code }}
        {% else %}
          {{ b.cost_center_id|default_if_none:"" }}
        {% endif %}
      </td>

      <td>{{ b.group_name }}</td>

      <td>{{ b.aile_yakacak|floatformat:2 }}</td>
      <td>{{ b.erzak|floatformat:2 }}</td>
      <td>{{ b.altin|floatformat:2 }}</td>
      <td>{{ b.bayram|floatformat:2 }}</td>
      <td>{{ b.dogum_evlenme|floatformat:2 }}</td>
      <td>{{ b.fon|floatformat:2 }}</td>
      <td>{{ b.harcirah|floatformat:2 }}</td>
      <td>{{ b.yol_parasi|floatformat:2 }}</td>
      <td>{{ b.prim|floatformat:2 }}</td>

      <!-- YEAR (Localization disabled) -->
      <td>
        {% localize off %}
            {{ b.year }}
        {% endlocalize %}
      </td>

      <!-- MONTH NAME -->
      <td>{{ b.get_month_display }}</td>
      <td class="text-nowrap">
        <div class="d-flex align-items-center gap-2">

          <!-- Update -->
          <a href="{% url 'benefits:update' b.id %}" 
            class="btn btn-sm btn-primary d-flex align-items-center justify-content-center"
            data-bs-toggle="tooltip" 
            data-bs-placement="top"
            title="Update">
              <i class="bi bi-pencil-square"></i>
          </a>

          <!-- Delete -->
          <a href="{% url 'benefits:delete' b.id %}" 
            class="btn btn-sm btn-danger d-flex align-items-center justify-content-center"
            data-bs-toggle="tooltip" 
            data-bs-placement="top"
            title="Delete"
            onclick="return confirm('Are you sure you want to delete this benefit record?');">
              <i class="bi bi-trash"></i>
          </a>
        </div>
      </td>

    </tr>
    {% empty %}
      <tr><td colspan="16" class="text-center text-muted">There is no benefits now</td></tr>
    {% endfor %}
  </tbody>
</table>


<nav aria-label="Sayfalama">
  <ul class="pagination justify-content-center">

    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link"
           href="?page=1{% if query %}&q={{ query }}{% endif %}{% if selected_year %}&year={{ selected_year }}{% endif %}{% if selected_month %}&month={{ selected_month }}{% endif %}">
           &laquo; First
        </a>
      </li>

      <li class="page-item">
        <a class="page-link"
           href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if selected_year %}&year={{ selected_year }}{% endif %}{% if selected_month %}&month={{ selected_month }}{% endif %}">
           Previous
        </a>
      </li>
    {% endif %}

    <li class="page-item active">
      <span class="page-link">Page {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
    </li>

    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link"
           href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if selected_year %}&year={{ selected_year }}{% endif %}{% if selected_month %}&month={{ selected_month }}{% endif %}">
           Next
        </a>
      </li>

      <li class="page-item">
        <a class="page-link"
           href="?page={{ page_obj.paginator.num_pages }}{% if query %}&q={{ query }}{% endif %}{% if selected_year %}&year={{ selected_year }}{% endif %}{% if selected_month %}&month={{ selected_month }}{% endif %}">
           Last &raquo;
        </a>
      </li>
    {% endif %}
  </ul>
</nav>

{% endblock %}
