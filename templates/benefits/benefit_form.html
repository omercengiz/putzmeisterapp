{% extends "layout.html" %}
{% load crispy_forms_tags %}
{% load l10n %}

{% block body %}
<div class="row">
    <div class="col-md-10 offset-md-1"> 

        <h3>{{ title }}</h3>
        <hr>

        <form method="post" novalidate>
            {% csrf_token %}

            <div class="row">
                <!-- Worker -->
                <div class="col-md-6 mb-3">
                    {{ form.worker|as_crispy_field }}
                </div>

                <!-- Year -->
                <div class="col-md-3 mb-3">
                    {{ form.year|as_crispy_field }}
                </div>

                <!-- Month -->
                <div class="col-md-3 mb-3">
                    {{ form.month|as_crispy_field }}
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">{{ form.aile_yakacak|as_crispy_field }}</div>
                <div class="col-md-6 mb-3">{{ form.erzak|as_crispy_field }}</div>

                <div class="col-md-6 mb-3">{{ form.altin|as_crispy_field }}</div>
                <div class="col-md-6 mb-3">{{ form.bayram|as_crispy_field }}</div>

                <div class="col-md-6 mb-3">{{ form.dogum_evlenme|as_crispy_field }}</div>
                <div class="col-md-6 mb-3">{{ form.fon|as_crispy_field }}</div>

                <div class="col-md-6 mb-3">{{ form.harcirah|as_crispy_field }}</div>
                <div class="col-md-6 mb-3">{{ form.yol_parasi|as_crispy_field }}</div>

                <div class="col-md-6 mb-3">{{ form.prim|as_crispy_field }}</div>
            </div>

            <div class="d-flex justify-content-end mt-3">
                <a href="{% url 'benefits:list' %}" class="btn btn-secondary me-2">Cancel</a>
                <button type="submit" class="btn btn-success">{{ title }}</button>
            </div>
        </form>

    </div>
</div>
<script>
function addThousandsTR(num) {
    num = num.replace(/\D/g, "");
    return num.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".tr-money").forEach(function (input) {

        /* -------- FOCUS -------- */
        // Input'a tıklanınca sadece "0" ise sil
        input.addEventListener("focus", function () {
            if (this.value === "0") {
                this.value = "";
            }
        });

        /* -------- INPUT (LIVE FORMAT) -------- */
        input.addEventListener("input", function () {
            let value = this.value;

            // sadece rakam ve virgül
            value = value.replace(/[^0-9,]/g, "");

            // birden fazla virgül varsa fazlasını at
            const parts = value.split(",");
            let intPart = parts[0] || "";
            let decPart = parts[1] || "";

            // decimal max 2 hane
            decPart = decPart.slice(0, 2);

            // integer kısmını formatla
            intPart = addThousandsTR(intPart);

            // virgül yazıldıysa koru
            if (value.includes(",")) {
                this.value = intPart + "," + decPart;
            } else {
                this.value = intPart;
            }
        });

        /* -------- BLUR -------- */
        input.addEventListener("blur", function () {
            let value = this.value.trim();

            if (value === "") {
                this.value = "0";
                return;
            }

            let [intPart, decPart] = value.split(",");

            intPart = addThousandsTR(intPart || "");

            this.value = decPart !== undefined
                ? `${intPart},${decPart}`
                : intPart;
        });
    });
});
</script>
{% endblock %}
