{% extends "layout.html" %}
{% load l10n %}

{% block body %}
<div class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="mb-0">Salary Details</h3>

      <!-- YIL FİLTRESİ -->
      <form method="get" class="d-flex align-items-center">
        <label class="me-2 fw-bold">Year:</label>

        {% localize off %}
        <select name="year" class="form-select w-auto" onchange="this.form.submit()">
          {% for y in year_list %}
            <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>
              {{ y }}
            </option>
          {% endfor %}
        </select>
        {% endlocalize %}
      </form>
  </div>

  <!-- Çalışan Bilgileri -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title">{{ worker.name_surname }}</h5>
      <p class="mb-1"><strong>Sicil No:</strong> {{ worker.sicil_no }}</p>
      <p class="mb-1"><strong>Tanımlı Gross Payment:</strong> {{ worker.gross_payment|floatformat:2|localize }}</p>
      <p class="mb-0"><strong>Currency:</strong> {{ worker.currency }}</p>
    </div>
  </div>

  <!-- Maaş Tablosu -->
  <div class="card shadow-sm">
    <div class="card-body">

      <table class="table table-striped align-middle">
        <thead class="table-dark">
          <tr>
            <th>Month</th>
            <th>Year</th>
            <th class="text-end">Salary</th>
            <th class="text-center">Process</th>
          </tr>
        </thead>
        <tbody>
          {% for row in months_data %}
          <tr>
            <td>{{ row.month }}</td>
            <td>
              {% localize off %}{{ row.year }}{% endlocalize %}
            </td>
            <td class="text-end">
              {% if row.salary %}
                  {{ row.salary.gross_salary|floatformat:2|localize }}
              {% else %}
                  <span class="text-muted">There is no salary for this month</span>
              {% endif %}
            </td>
            <td class="text-center">
              <div class="d-flex justify-content-center gap-2">
                <a href="{% url 'workers:update_salary_record' row.salary.id|default:0 %}?worker_id={{ worker.id }}&month={{ row.month_num }}&year={{ row.year }}"
                   class="btn btn-sm btn-primary">
                    {% if row.salary %}Update{% else %}Add{% endif %}
                </a>

                {% if row.salary %}
                <a href="{% url 'workers:delete_salary_record' row.salary.id %}"
                   class="btn btn-sm btn-danger"
                   onclick="return confirm('Bu maaş kaydını silmek istediğinize emin misiniz?');">
                   Delete
                </a>
                {% endif %}
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

    </div>
  </div>

</div>
{% endblock %}
